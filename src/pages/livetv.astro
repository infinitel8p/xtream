---
import Login from "@/components/login.astro";
import Layout from "@/layouts/Layout.astro";
---

<Layout>
	<div class="">
		<!-- Decorative background accents -->
		<div aria-hidden="true" class="pointer-events-none fixed inset-0 -z-10">
			<div
				class="absolute -top-24 -left-24 h-72 w-72 rounded-full bg-indigo-600/20 blur-3xl">
			</div>
			<div
				class="absolute -bottom-24 -right-24 h-80 w-80 rounded-full bg-fuchsia-600/20 blur-3xl">
			</div>
			<div
				class="absolute inset-0 bg-[radial-gradient(ellipse_at_top,rgba(99,102,241,0.08),transparent_60%),radial-gradient(ellipse_at_bottom,rgba(168,85,247,0.06),transparent_60%)]">
			</div>
		</div>

		<main
			class="mx-auto px-4 py-10 lg:pt-6 md:landscape:pt-6 md:px-6 lg:px-8 md:landscape:px-8">
			<section
				class="lg:grid md:landscape:grid grid-cols-1 gap-5 lg:grid-cols-3 md:landscape:grid-cols-3 h-full flex flex-col-reverse lg:flex-row md:landscape:flex-row">
				<!-- Sidebar -->
				<aside class="lg:col-span-1 md:landscape:col-span-1">
					<div
						class="rounded-2xl border border-white/10 bg-white/1 p-3 shadow-lg shadow-black/30 backdrop-blur lg:h-full md:landscape:h-full">
						<div class="mb-3 flex items-center gap-2 flex-wrap">
							<label class="sr-only" for="search"
								>Search channels</label
							>
							<div class="relative w-full">
								<svg
									class="pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"
									xmlns="http://www.w3.org/2000/svg"
									fill="none"
									viewBox="0 0 24 24"
									stroke="currentColor"
									><path
										stroke-linecap="round"
										stroke-linejoin="round"
										stroke-width="1.5"
										d="M21 21l-4.35-4.35M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z"
									></path></svg
								>
								<input
									id="search"
									type="search"
									placeholder="Search channels…"
									class="w-full rounded-xl border border-white/10 bg-white/5 pl-9 pr-3 py-2 text-sm text-white placeholder:text-gray-400 outline-none ring-0 transition focus:border-indigo-400/30 focus:bg-white/10 focus:ring-2 focus:ring-indigo-500/40"
								/>
							</div>
							<button
								id="clear-search"
								title="Clear"
								class="hidden shrink-0 rounded-lg border border-white/10 px-2 py-2 text-xs text-gray-300 hover:bg-white/10"
								>Clear</button
							>
						</div>

						<div class="mb-3 relative">
							<div class="flex items-center gap-2 flex-wrap">
								<button
									id="cat-trigger"
									type="button"
									class="flex-1 rounded-xl border border-white/10 bg-white/5 px-3 py-2 text-sm text-white outline-none transition hover:bg-white/10 focus:border-indigo-400/30 focus:bg-white/10 focus:ring-2 focus:ring-indigo-500/40 flex items-center justify-between">
									<span
										id="cat-trigger-label"
										class="truncate">All categories</span
									>
									<svg
										id="cat-trigger-icon"
										class="ml-2 h-4 w-4 text-gray-400 transition-transform"
										xmlns="http://www.w3.org/2000/svg"
										fill="none"
										viewBox="0 0 24 24"
										stroke="currentColor"
										><path
											stroke-linecap="round"
											stroke-linejoin="round"
											stroke-width="2"
											d="M19 9l-7 7-7-7"></path></svg
									>
								</button>
								<button
									id="clear-cat"
									title="Clear category"
									class="shrink-0 rounded-lg border border-white/10 px-2 py-2 text-xs text-gray-300 hover:bg-white/10">
									Clear
								</button>
							</div>
							<!-- Popover panel -->
							<div
								id="cat-popover"
								class="hidden absolute z-50 mt-2 w-full rounded-2xl border border-white/10 bg-black/85 shadow-lg shadow-black/30 backdrop-blur">
								<div
									id="cat-list"
									role="listbox"
									class="max-h-[calc(100vh-20rem)] overflow-auto py-2 custom-scroll">
								</div>
							</div>
						</div>

						<div
							id="list"
							class="relative max-h-[calc(100vh-20rem)] overflow-auto pr-1 custom-scroll">
							<div id="spacer"></div>
							<div id="viewport" class="absolute inset-0"></div>
						</div>

						<div
							id="list-status"
							class="mt-2 px-2.5 text-sm text-gray-400">
							Enter Xtream Codes credentials and click “Load
							Channels”, <br />
							or paste an M3U/M3U8 playlist URL in the Host field (leave
							user/pass empty).
						</div>
					</div>
				</aside>

				<!-- Player -->
				<section class="lg:col-span-2 md:landscape:col-span-2">
					<div
						class="rounded-2xl border border-white/10 bg-white/1 p-3 shadow-xl shadow-black/30 backdrop-blur">
						<div
							class="aspect-video w-full overflow-hidden rounded-xl bg-black ring-1 ring-white/10 flex items-center justify-center">
							<video
								id="player"
								class="video-js vjs-default-skin vjs-big-play-centered h-full w-full"
								controls
								hidden
								playsinline></video>
						</div>

						<div
							id="current"
							class="mt-3 flex items-center justify-between gap-2 text-sm text-gray-300">
							<div class="flex items-center gap-2">
								<span
									class="inline-flex h-6 w-6 items-center justify-center rounded-lg bg-gradient-to-br from-indigo-500 to-fuchsia-600 text-[10px] font-bold text-white ring-1 ring-white/10"
									>OFF</span
								>
								<span class="truncate">—</span>
							</div>
						</div>

						<div
							id="epg"
							class="mt-4 rounded-xl border border-white/10 p-3">
							<div class="mb-2 flex items-center justify-between">
								<div class="text-sm font-medium">EPG</div>
								<div class="text-xs text-gray-400">
									All times local
								</div>
							</div>
							<div id="epg-list" class="space-y-2 text-sm"></div>
						</div>
					</div>
				</section>
			</section>
			<div
				id="app-version"
				class="fixed bottom-2 right-3 text-[11px] text-gray-500 dark:text-gray-400 opacity-70">
				loading…
			</div>
			<div
				id="account-expiration"
				class="fixed bottom-2 left-3 text-[11px] text-gray-500 dark:text-gray-400 opacity-70">
				loading…
			</div>
		</main>

		<script>
			import "../scripts/stream.js";
			import "../scripts/updater-startup.js";
			import { injectVersion } from "../scripts/version.js";
			import { injectExpirationDate } from "../scripts/expiration.js";
			injectVersion();
			injectExpirationDate(
				localStorage.getItem("xt_host") || "",
				localStorage.getItem("xt_port") || "",
				localStorage.getItem("xt_user") || "",
				localStorage.getItem("xt_pass") || ""
			);
		</script>
	</div>
</Layout>
